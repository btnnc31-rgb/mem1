<VirtualHost *:80>
    ServerName app.yourdomain.com
    DocumentRoot /var/www/memegrave/frontend/build

    # Redirect HTTP to HTTPS
    Redirect "/" "https://app.yourdomain.com/"
</VirtualHost>

<VirtualHost *:443>
    ServerName app.yourdomain.com
    DocumentRoot /var/www/memegrave/frontend/build

    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/app.yourdomain.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/app.yourdomain.com/privkey.pem

    <Directory "/var/www/memegrave/frontend/build">
        AllowOverride All
        Require all granted
    </Directory>

    # Proxy /api to backend
    ProxyPreserveHost On
    ProxyRequests Off
    ProxyPass /api http://127.0.0.1:4000/api
    ProxyPassReverse /api http://127.0.0.1:4000/api

    # SPA fallback - ensure mod_rewrite enabled
    <IfModule mod_rewrite.c>
      RewriteEngine On
      RewriteCond %{REQUEST_FILENAME} !-f
      RewriteRule ^ index.html [QSA,L]
    </IfModule>
</VirtualHost>